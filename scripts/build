#!/bin/sh

rm -rf build docs
mkdir -p build docs

pages="${@:-$(ls config | sed s/.json//)}"

clear >$(tty)

echo ""
echo "      _               _               "
echo "     | |             (_)              "
echo "  ___| | __ _ ___ ___ _  ___ ___  ___ "
echo " / __| |/ _\` / __/ __| |/ __/ _ \/ __| "
echo "| (__| | (_| \__ \__ \ | (_| (_) \__ \ "
echo " \___|_|\__,_|___/___/_|\___\___/|___/"
echo ""
echo ""

echo "Starting build"
echo ""
echo ""

for page in $pages ; do

		echo "Creating $page page"

    # Builds the code.
    npx stylus --compress \
        < src/index.styl \
        > build/index.css
    ./node_modules/pug-cli/index.js --obj config/$page.json \
        < src/index.pug \
        > build/$page.html

    # Bundles the files.
    cat build/$page.html | \
        ./node_modules/inline-source-cli/dist/index.js --root build/ > \
        docs/$page.html

done

echo "Done."

rm -rf build
